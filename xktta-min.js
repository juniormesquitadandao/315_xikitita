!function(window){"use strict";var Xktta={window:this,afterInit:[],defineProperties:function(t,e){var n=this;Object.keys(e).forEach(function(r){n.defineProperty(t,r,e[r])})},defineProperty:function(t,e,n){t.hasOwnProperty(e)||Object.defineProperty(t,e,n)}};Object.defineProperty(Xktta,"init",{get:function(){return this.classes={},this.inflection={singular:{},plural:{}},this.translations={},this.validators={},this.afterInit.forEach(function(t){t()}),this}}),Xktta.Inflection=function(body){var __this__=this,irregular=function(t,e){__this__.inflection.singular[t]=e,__this__.inflection.plural[e]=t};return eval("new function (){\n      var irregular = #{irregular};\n      (#{body})(this);\n    };".interpolate({irregular:irregular.toString(),body:body.toString()})),__this__},Xktta.I18n=function(t,e){return this.translations[t]=e||{},this},Xktta.afterInit.push(function(){var t=Xktta;eval.call(t.window,"var I18n;"),I18n={locale:"en",translate:function(e,n){var r=e,a=t.translations[I18n.locale]||{};return e.split(".").forEach(function(t){a=a[t]||{}}),"string"==typeof a?(r=a,n=n||{},r=r.interpolate(n,"%")):r="object"==typeof a&&"Array"===a.constructor.name?a:"#{locale}.#{path}".interpolate({locale:I18n.locale,path:e}),r},localize:function(e,n){n=n||{};var r=n.format||"default",a=n.dateType||"date",i=e;if("object"==typeof e&&"Date"===e.constructor.name){var o=e.getDay(),s=e.getMonth()+1,c=e.getDate(),u=e.getFullYear(),l=e.getHours(),f=e.getMinutes(),_=e.getSeconds(),h=12>l?"am":"pm",g=e.toString().match(/([A-Z]+[\+-][0-9]+.*)/)[1];i=t.translations[I18n.locale][a].formats[r];var d={"function":function(){i=i(e)},string:function(){var t={date:function(){i=i.interpolate({a:I18n.t("date.abbrDayNames")[o],A:I18n.t("date.dayNames")[o],m:new String(s+100).toString().substr(1),b:I18n.t("date.abbrMonthNames")[s],B:I18n.t("date.monthNames")[s],d:new String(c+100).toString().substr(1),Y:u},"%",!1)},time:function(){i=i.interpolate({h:new String((l||24)-12+100).toString().substr(1),H:new String(l+100).toString().substr(1),M:new String(f+100).toString().substr(1),S:new String(_+100).toString().substr(1),p:I18n.t(["time",h].join(".")),z:g},"%",!1)},datetime:function(){this.date(),this.time()}};t[a]()}};d[typeof i]()}else if("number"==typeof e){var p=t.translations[I18n.locale].integer.formats[r];(/\./.test(e)||n.forceDecimal)&&(p=t.translations[I18n.locale].decimal.formats[r]),i=p(e)}else"boolean"==typeof e&&(i=t.translations[I18n.locale].logic.formats[r][e]);return i}},I18n.t=I18n.translate,I18n.l=I18n.localize}),Xktta.Error=function(t){var e=this,n=t;Object.defineProperties(e,{add:{value:function(t,n){e[t]=e[t]||[],e[t].push(n)}},clear:{get:function(){for(var t in e)delete e[t]}},messages:{get:function(){var t=[];return Object.keys(e).forEach(function(n){e[n].forEach(function(e){t.push(e)})}),t}},fullMessages:{get:function(){var t=[];return Object.keys(e).forEach(function(r){var a=["classes",n,"attributes",r].join("."),i=I18n.t(a);e[r].forEach(function(e){var n=I18n.t("errors.format").interpolate({attribute:i,message:e},"%");t.push(n)})}),t}}})},Xktta.Class=function(name,body){eval.call(Xktta.window,"function #{name}(){\n      var Xktta = Xktta;\n      var __class__ =  #{name};\n      var __attrAccessor__ = [];\n      \n      var object = this;\n      var attrAccessor = #{attrAccessor};\n      \n      var __afterNew__ = [];\n      \n      var __errors__ = new #{Error}(__class__.name.toLowerCase());\n      var __validations__ = [];\n      Object.defineProperties(object, {\n        'errors': {get: #{errors}, enumerable: false },\n        'isValid': {get: #{isValid}, enumerable: false }\n      });\n      \n      var validate = #{validate};\n      \n      var validates = #{validates};\n      \n      var def = #{def};\n      var defClass = #{defClass};\n      \n      #{validatesOf}\n      \n      (#{body})(object);\n      attrAccessor();\n      \n      var __initAttributes__ =  Array.prototype.slice.call(arguments).shift() || {};\n      (#{new})(object);\n      \n      Object.defineProperties(object, {\n        'reset': {get: #{reset}, enumerable: false },\n        'changes': {get: #{changes}, enumerable: false },\n        'changed': {get: #{changed}, enumerable: false },\n        'toHuman': {get: #{toHuman}, enumerable: false }\n      });\n    };".interpolate({name:name,attrAccessor:Xktta.attrAccessor.toString(),Error:Xktta.Error.toString(),errors:Xktta.errors.toString(),isValid:Xktta.isValid.toString(),validate:Xktta.validate.toString(),validates:Xktta.validates.toString(),def:Xktta.def.toString(),defClass:Xktta.defClass.toString(),validatesOf:Xktta.validatesOf(),body:body.toString(),"new":Xktta["new"].toString(),reset:Xktta.reset.toString(),changes:Xktta.changes.toString(),changed:Xktta.changed.toString(),toHuman:Xktta.toHuman.toString()}));var Class=eval(name);return Object.defineProperty(Class,"toHuman",{get:function(){var t=Class.name.toLowerCase(),e=["classes",t,"member"].join("."),n=["classes",t,"collection"].join(".");return{member:I18n.t(e),collection:I18n.t(n)}}}),Object.defineProperties(Class.prototype,{Xktta:{get:function(){return Xktta}}}),this.classes[name]=Class,this},Xktta.attrAccessor=function(){var t=Array.prototype.slice.call(arguments);t.forEach(function(t){object[t]=null,__attrAccessor__.push(t)})},Xktta["new"]=function(){function t(t){var e=["changes",t].join("_");object.hasOwnProperty(e)||Object.defineProperty(object,e,{get:function(){return this.changes[t]||[]}})}function e(t){var e=["changes",t].join("_"),n=["changed",t].join("_");object.hasOwnProperty(n)||Object.defineProperty(object,n,{get:function(){return this[e].isAny}})}"string"==typeof __initAttributes__&&(__initAttributes__=JSON.parse(__initAttributes__)),__attrAccessor__.forEach(function(n){__afterNew__.push(function(){t(n),e(n)})}),__attrAccessor__.forEach(function(t){Object.keys(__initAttributes__).indexOf(t)<0&&(__initAttributes__[t]=null)}),Object.keys(__initAttributes__).forEach(function(t){if(__attrAccessor__.indexOf(t)<0)throw new TypeError(__class__.name.toLowerCase()+"."+t+" is not a attribute");object[t]=__initAttributes__[t]}),__afterNew__.forEach(function(t){t()})},Xktta.reset=function(){Object.keys(object).forEach(function(t){object[t]=__initAttributes__[t]}),__afterNew__.forEach(function(t){t()})},Xktta.changes=function(){var t={};return __attrAccessor__.forEach(function(e){var n=__initAttributes__[e],r=object[e];null===n&&null!==r?t[e]=[n,r]:null!==n&&null===r?t[e]=[n,r]:null!==n&&null!==r&&n.toJson!==r.toJson&&(t[e]=[n,r])}),t},Xktta.changed=function(){return this.changes.isAny},Xktta.def=function(t,e){Object.defineProperty(object,t,{value:e,enumerable:!1})},Xktta.defClass=function(t,e){__class__[t]=__class__[t]||e},Xktta.toHuman=function(){var t={},e=__class__.name.toLowerCase();return __attrAccessor__.forEach(function(n){Object.defineProperty(t,n,{get:function(){var t=["classes",e,"attributes",n].join(".");return I18n.t(t)}})}),t},Xktta.validate=function(t,e){__validations__.push(function(){var n=e.call();if(!n.success){var r=n.fail.messageName,a=["errors","messages",r].join("."),i=n.fail.params||{};__errors__.add(t,I18n.t(a,i))}})},Xktta.validates=function(t,e){Object.keys(e).forEach(function(n){var r={};"object"==typeof e[n]&&(r=e[n]),__validations__.push(function(){var e=object[t],a=object.Xktta.validators[n](e,t,object,r);if(!a.success){var i=a.fail.messageName,o=["errors","messages",i].join("."),s=a.fail.params||{};__errors__.add(t,I18n.t(o,s))}})})},Xktta.validatesOf=function(){var t=[];return Object.keys(Xktta.validators).forEach(function(e){t.push("var validates#{validator}Of = ".interpolate({validator:e.capitalize})+function(){var t=Array.prototype.slice.call(arguments),e=t.pop(),n="#{validatorName}",r={};r[n]=!0,"object"==typeof e?r[n]=e:t.push(e),t.forEach(function(t){validates(t,r)})}.toString().interpolate({validatorName:e})+";")}),t.join("\n")},Xktta.errors=function(){return __errors__},Xktta.isValid=function(){return __errors__.clear,__validations__.forEach(function(t){t()}),__errors__.isEmpty},Xktta.Validator=function(t,e){return this.validators[t.toLowerCase()]=e,this},Xktta.afterInit.push(function(){Xktta.Validator("Presence",function(t,e,n,r){return{success:t?t.isAny:["number","boolean"].indexOf(typeof t)>-1,fail:{messageName:"blank"}}}).Validator("Length",function(t,e,n,r){var a={maximum:function(e){return{success:t?t.length<=e:!1,fail:{messageName:1===e?"too_long.one":"too_long.other",params:{count:e}}}},minimum:function(e){return{success:t?t.length>=e:!1,fail:{messageName:1===e?"too_short.one":"too_short.other",params:{count:e}}}},"in":function(t){var e=this.minimum(t[0]);return e.success?this.maximum(t[1]):e},is:function(e){return{success:t?t.length===e:!1,fail:{messageName:1===e?"wrong_length.one":"wrong_length.other",params:{count:e}}}}},i={success:!0};return Object.keys(a).forEach(function(e){var n=r[e]||null;if(n){var o=a[e](n);r.allowNull&&null===t&&(o.success=!0),o.success||(i=o)}}),i})}),Xktta.afterInit.push(function(){Xktta.defineProperties(Object.prototype,{toJson:{get:function(){var t=this;return"string"!=typeof this&&(t=JSON.stringify(t)),t}},asJson:{get:function(){return JSON.parse(this.toJson)}},isAny:{get:function(){return"Number"===this.constructor.name&&this>0||"Boolean"===this.constructor.name&&this||"Date"===this.constructor.name||Object.keys(this).length>0}},isEmpty:{get:function(){return!this.isAny}}})}),Xktta.afterInit.push(function(){Xktta.defineProperties(String.prototype,{capitalize:{get:function(){return this.replace(/(\w)/,function(t){return t.toUpperCase()})}},pluralize:{get:function(){var t=this,e=t,n=Xktta.inflection.singular[t]||null;return n||(e=/$/,n="s"),this.replace(e,n)}},singularize:{get:function(){var t=this,e=t,n=Xktta.inflection.plural[t]||null;return n||(e=/s$/,n=""),this.replace(e,n)}},interpolate:{value:function(t,e,n){e=e||"#",n=void 0===n?!0:n;var r=n?"{}":"  ",a=this;return Object.keys(t).forEach(function(n){var i=[e,r[0].trim(),n,r[1].trim()].join("");a=a.replace(new RegExp(i,"g"),t[n])}),a}}})}),Xktta.afterInit.push(function(){Xktta.defineProperties(Date.prototype,{localize:{value:function(t){return this.l(t)}},l:{value:function(t){return I18n.l(this,t)}}})}),Xktta.afterInit.push(function(){Xktta.defineProperties(Number.prototype,{localize:{value:function(t){return this.l(t)}},l:{value:function(t){return I18n.l(this,t)}}})}),Xktta.afterInit.push(function(){Xktta.defineProperties(Boolean.prototype,{localize:{value:function(t){return this.l(t)}},l:{value:function(t){return I18n.l(this,t)}}})}),window.Xktta=Xktta}(window);