!function(window){"use strict";var Xikitita={window:this,afterInit:[],defineProperties:function(t,i){var e=this;Object.keys(i).forEach(function(n){e.defineProperty(t,n,i[n])})},defineProperty:function(t,i,e){t.hasOwnProperty(i)||Object.defineProperty(t,i,e)}};Object.defineProperty(Xikitita,"init",{get:function(){return this.classes={},this.inflection={singular:{},plural:{}},this.translations={},this.validators={},this.afterInit.forEach(function(t){t()}),this}}),Xikitita.Inflection=function(body){var __this__=this,irregular=function(t,i){__this__.inflection.singular[t]=i,__this__.inflection.plural[i]=t};return eval("new function (){\n      var irregular = #{irregular};\n      (#{body})(this);\n    };".interpolate({irregular:irregular.toString(),body:body.toString()})),__this__},Xikitita.I18n=function(t,i){return this.translations[t]=i||{},this},Xikitita.afterInit.push(function(){var t=Xikitita;eval.call(t.window,"var I18n;"),I18n={locale:"en",translate:function(i,e){var n=i,r=t.translations[I18n.locale]||{};return i.split(".").forEach(function(t){r=r[t]||{}}),"string"==typeof r?(n=r,e=e||{},n=n.interpolate(e,"%")):n="object"==typeof r&&"Array"===r.constructor.name?r:"#{locale}.#{path}".interpolate({locale:I18n.locale,path:i}),n},localize:function(i,e){e=e||{};var n=e.format||"default",r=e.dateType||"date",a=i;if("object"==typeof i&&"Date"===i.constructor.name){var o=i.getDay(),s=i.getMonth()+1,c=i.getDate(),u=i.getFullYear(),l=i.getHours(),f=i.getMinutes(),_=i.getSeconds(),h=12>l?"am":"pm",g=i.toString().match(/([A-Z]+[\+-][0-9]+.*)/)[1];a=t.translations[I18n.locale][r].formats[n];var d={"function":function(){a=a(i)},string:function(){var t={date:function(){a=a.interpolate({a:I18n.t("date.abbrDayNames")[o],A:I18n.t("date.dayNames")[o],m:new String(s+100).toString().substr(1),b:I18n.t("date.abbrMonthNames")[s],B:I18n.t("date.monthNames")[s],d:new String(c+100).toString().substr(1),Y:u},"%",!1)},time:function(){a=a.interpolate({h:new String((l||24)-12+100).toString().substr(1),H:new String(l+100).toString().substr(1),M:new String(f+100).toString().substr(1),S:new String(_+100).toString().substr(1),p:I18n.t(["time",h].join(".")),z:g},"%",!1)},datetime:function(){this.date(),this.time()}};t[r]()}};d[typeof a]()}else if("number"==typeof i){var p=t.translations[I18n.locale].integer.formats[n];(/\./.test(i)||e.forceDecimal)&&(p=t.translations[I18n.locale].decimal.formats[n]),a=p(i)}else"boolean"==typeof i&&(a=t.translations[I18n.locale].logic.formats[n][i]);return a}},I18n.t=I18n.translate,I18n.l=I18n.localize}),Xikitita.Error=function(t){var i=this,e=t;Object.defineProperties(i,{add:{value:function(t,e){i[t]=i[t]||[],i[t].push(e)}},clear:{get:function(){for(var t in i)delete i[t]}},messages:{get:function(){var t=[];return Object.keys(i).forEach(function(e){i[e].forEach(function(i){t.push(i)})}),t}},fullMessages:{get:function(){var t=[];return Object.keys(i).forEach(function(n){var r=["classes",e,"attributes",n].join("."),a=I18n.t(r);i[n].forEach(function(i){var e=I18n.t("errors.format").interpolate({attribute:a,message:i},"%");t.push(e)})}),t}}})},Xikitita.Class=function(name,body){eval.call(Xikitita.window,"function #{name}(){\n      var Xikitita = Xikitita;\n      var __class__ =  #{name};\n      var __attrAccessor__ = [];\n      \n      var object = this;\n      var attrAccessor = #{attrAccessor};\n      \n      var __afterNew__ = [];\n      \n      var __errors__ = new #{Error}(__class__.name.toLowerCase());\n      var __validations__ = [];\n      Object.defineProperties(object, {\n        'errors': {get: #{errors}, enumerable: false },\n        'isValid': {get: #{isValid}, enumerable: false }\n      });\n      \n      var validate = #{validate};\n      \n      var validates = #{validates};\n      \n      var def = #{def};\n      var defClass = #{defClass};\n      \n      #{validatesOf}\n      \n      (#{body})(object);\n      attrAccessor();\n      \n      var __initAttributes__ =  Array.prototype.slice.call(arguments).shift() || {};\n      (#{new})(object);\n      \n      Object.defineProperties(object, {\n        'reset': {get: #{reset}, enumerable: false },\n        'changes': {get: #{changes}, enumerable: false },\n        'changed': {get: #{changed}, enumerable: false },\n        'toHuman': {get: #{toHuman}, enumerable: false }\n      });\n    };".interpolate({name:name,attrAccessor:Xikitita.attrAccessor.toString(),Error:Xikitita.Error.toString(),errors:Xikitita.errors.toString(),isValid:Xikitita.isValid.toString(),validate:Xikitita.validate.toString(),validates:Xikitita.validates.toString(),def:Xikitita.def.toString(),defClass:Xikitita.defClass.toString(),validatesOf:Xikitita.validatesOf(),body:body.toString(),"new":Xikitita["new"].toString(),reset:Xikitita.reset.toString(),changes:Xikitita.changes.toString(),changed:Xikitita.changed.toString(),toHuman:Xikitita.toHuman.toString()}));var Class=eval(name);return Object.defineProperty(Class,"toHuman",{get:function(){var t=Class.name.toLowerCase(),i=["classes",t,"member"].join("."),e=["classes",t,"collection"].join(".");return{member:I18n.t(i),collection:I18n.t(e)}}}),Object.defineProperties(Class.prototype,{Xikitita:{get:function(){return Xikitita}}}),this.classes[name]=Class,this},Xikitita.attrAccessor=function(){var t=Array.prototype.slice.call(arguments);t.forEach(function(t){object[t]=null,__attrAccessor__.push(t)})},Xikitita["new"]=function(){function t(t){var i=["changes",t].join("_");object.hasOwnProperty(i)||Object.defineProperty(object,i,{get:function(){return this.changes[t]||[]}})}function i(t){var i=["changes",t].join("_"),e=["changed",t].join("_");object.hasOwnProperty(e)||Object.defineProperty(object,e,{get:function(){return this[i].isAny}})}"string"==typeof __initAttributes__&&(__initAttributes__=JSON.parse(__initAttributes__)),__attrAccessor__.forEach(function(e){__afterNew__.push(function(){t(e),i(e)})}),__attrAccessor__.forEach(function(t){Object.keys(__initAttributes__).indexOf(t)<0&&(__initAttributes__[t]=null)}),Object.keys(__initAttributes__).forEach(function(t){if(__attrAccessor__.indexOf(t)<0)throw new TypeError(__class__.name.toLowerCase()+"."+t+" is not a attribute");object[t]=__initAttributes__[t]}),__afterNew__.forEach(function(t){t()})},Xikitita.reset=function(){Object.keys(object).forEach(function(t){object[t]=__initAttributes__[t]}),__afterNew__.forEach(function(t){t()})},Xikitita.changes=function(){var t={};return __attrAccessor__.forEach(function(i){var e=__initAttributes__[i],n=object[i];null===e&&null!==n?t[i]=[e,n]:null!==e&&null===n?t[i]=[e,n]:null!==e&&null!==n&&e.toJson!==n.toJson&&(t[i]=[e,n])}),t},Xikitita.changed=function(){return this.changes.isAny},Xikitita.def=function(t,i){Object.defineProperty(object,t,{value:i,enumerable:!1})},Xikitita.defClass=function(t,i){__class__[t]=__class__[t]||i},Xikitita.toHuman=function(){var t={},i=__class__.name.toLowerCase();return __attrAccessor__.forEach(function(e){Object.defineProperty(t,e,{get:function(){var t=["classes",i,"attributes",e].join(".");return I18n.t(t)}})}),t},Xikitita.validate=function(t,i){__validations__.push(function(){var e=i.call();if(!e.success){var n=e.fail.messageName,r=["errors","messages",n].join("."),a=e.fail.params||{};__errors__.add(t,I18n.t(r,a))}})},Xikitita.validates=function(t,i){Object.keys(i).forEach(function(e){var n={};"object"==typeof i[e]&&(n=i[e]),__validations__.push(function(){var i=object[t],r=object.Xikitita.validators[e](i,t,object,n);if(!r.success){var a=r.fail.messageName,o=["errors","messages",a].join("."),s=r.fail.params||{};__errors__.add(t,I18n.t(o,s))}})})},Xikitita.validatesOf=function(){var t=[];return Object.keys(Xikitita.validators).forEach(function(i){t.push("var validates#{validator}Of = ".interpolate({validator:i.capitalize})+function(){var t=Array.prototype.slice.call(arguments),i=t.pop(),e="#{validatorName}",n={};n[e]=!0,"object"==typeof i?n[e]=i:t.push(i),t.forEach(function(t){validates(t,n)})}.toString().interpolate({validatorName:i})+";")}),t.join("\n")},Xikitita.errors=function(){return __errors__},Xikitita.isValid=function(){return __errors__.clear,__validations__.forEach(function(t){t()}),__errors__.isEmpty},Xikitita.Validator=function(t,i){return this.validators[t.toLowerCase()]=i,this},Xikitita.afterInit.push(function(){Xikitita.Validator("Presence",function(t,i,e,n){return{success:t?t.isAny:["number","boolean"].indexOf(typeof t)>-1,fail:{messageName:"blank"}}}).Validator("Length",function(t,i,e,n){var r={maximum:function(i){return{success:t?t.length<=i:!1,fail:{messageName:1===i?"too_long.one":"too_long.other",params:{count:i}}}},minimum:function(i){return{success:t?t.length>=i:!1,fail:{messageName:1===i?"too_short.one":"too_short.other",params:{count:i}}}},"in":function(t){var i=this.minimum(t[0]);return i.success?this.maximum(t[1]):i},is:function(i){return{success:t?t.length===i:!1,fail:{messageName:1===i?"wrong_length.one":"wrong_length.other",params:{count:i}}}}},a={success:!0};return Object.keys(r).forEach(function(i){var e=n[i]||null;if(e){var o=r[i](e);n.allowNull&&null===t&&(o.success=!0),o.success||(a=o)}}),a})}),Xikitita.afterInit.push(function(){Xikitita.defineProperties(Object.prototype,{toJson:{get:function(){var t=this;return"string"!=typeof this&&(t=JSON.stringify(t)),t}},asJson:{get:function(){return JSON.parse(this.toJson)}},isAny:{get:function(){return"Number"===this.constructor.name&&this>0||"Boolean"===this.constructor.name&&this||"Date"===this.constructor.name||Object.keys(this).length>0}},isEmpty:{get:function(){return!this.isAny}}})}),Xikitita.afterInit.push(function(){Xikitita.defineProperties(String.prototype,{capitalize:{get:function(){return this.replace(/(\w)/,function(t){return t.toUpperCase()})}},pluralize:{get:function(){var t=this,i=t,e=Xikitita.inflection.singular[t]||null;return e||(i=/$/,e="s"),this.replace(i,e)}},singularize:{get:function(){var t=this,i=t,e=Xikitita.inflection.plural[t]||null;return e||(i=/s$/,e=""),this.replace(i,e)}},interpolate:{value:function(t,i,e){i=i||"#",e=void 0===e?!0:e;var n=e?"{}":"  ",r=this;return Object.keys(t).forEach(function(e){var a=[i,n[0].trim(),e,n[1].trim()].join("");r=r.replace(new RegExp(a,"g"),t[e])}),r}}})}),Xikitita.afterInit.push(function(){Xikitita.defineProperties(Date.prototype,{localize:{value:function(t){return this.l(t)}},l:{value:function(t){return I18n.l(this,t)}}})}),Xikitita.afterInit.push(function(){Xikitita.defineProperties(Number.prototype,{localize:{value:function(t){return this.l(t)}},l:{value:function(t){return I18n.l(this,t)}}})}),Xikitita.afterInit.push(function(){Xikitita.defineProperties(Boolean.prototype,{localize:{value:function(t){return this.l(t)}},l:{value:function(t){return I18n.l(this,t)}}})}),window.Xikitita=Xikitita}(window);